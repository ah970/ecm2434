{% extends "game/base.html" %}

{% block content %}
{% if user.player.is_game_master %}
	<form method="POST">
		{% csrf_token %}
		{{ form.as_p }}
		<div id="map_canvas" style="width: auto; height: 400px;"></div>
		<br>
		<button type="submit">Update event</button>
	</form>
{% else %}
	<p>You are not authorised to view this page.</p>
{% endif %}

<script src="https://code.jquery.com/jquery-3.5.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDMnC5aWhGCbN-EhosWewAzUyw8T8lVmLs"></script>
<script type="text/javascript">
function initialize() {
  // Creating map object
  var map = new google.maps.Map(document.getElementById('map_canvas'), {
  zoom: 16,
      center: new google.maps.LatLng({{ event.latitude }}, {{ event.longitude }}),
  mapTypeId: google.maps.MapTypeId.ROADMAP
});

// creates a draggable marker to the given coords
var vMarker = new google.maps.Marker({
    position: new google.maps.LatLng({{ event.latitude }}, {{ event.longitude }}),
draggable: true
});

// adds a listener to the marker
// gets the coords when drag event ends
// then updates the input with the new coords
google.maps.event.addListener(vMarker, 'dragend', function (evt) {
$("#id_latitude").val(evt.latLng.lat().toFixed(16));
$("#id_longitude").val(evt.latLng.lng().toFixed(16));
map.panTo(evt.latLng);
});

// centers the map on markers coords
map.setCenter(vMarker.position);
// adds the marker on the map
vMarker.setMap(map);
}
</script>
{% endblock %}
